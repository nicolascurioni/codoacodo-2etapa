<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/newstyle.css">

    <title>Perfil de Usuario</title>
</head>
<body>
    <h2>Perfil de Usuario</h2>
    
    <div id="user-info">
        <p>Usuario: <span id="username">{{ usuarioInfo.usuario }}</span></p>
        <p>Nombre: <span id="nombre">{{ usuarioInfo.nombre }}</span></p>
        <p>Apellido: <span id="apellido">{{ usuarioInfo.apellido }}</span></p>
        <p>Dirección: <span id="direccion">{{ usuarioInfo.direccion }}</span></p>
        <p>Ciudad: <span id="ciudad">{{ usuarioInfo.ciudad }}</span></p>
        <p>Provincia: <span id="provincia">{{ usuarioInfo.provincia }}</span></p>
        <p>Teléfono: <span id="telefono">{{ usuarioInfo.telefono }}</span></p>
    </div>

    <div id="error-message" style="display: none;">
        <p id="error-content"></p>
        <button onclick="cerrarMensajeError()">Cerrar</button>
    </div>

    <button onclick="editarUsuario()">Editar</button>
    <button onclick="eliminarUsuario()">Borrar</button>
    <input type="hidden" id="usuario_id" value="{{ usuarioInfo.id }}">



    <script>
        function ObtenerUsuarioId() {
        // Lógica para obtener el usuario_id, por ejemplo, desde algún elemento en tu HTML
        return document.getElementById('usuario_id').value;
        }

        function mostrarMensajeError(mensaje) {
            document.getElementById('error-content').textContent = mensaje;
            document.getElementById('error-message').style.display = 'block';
        }

        function cerrarMensajeError() {
            document.getElementById('error-message').style.display = 'none';
        }

        function editarUsuario() {
            // Redirigir a la página de edición
            window.location.href = '/editar.html';
        }

        function eliminarUsuario() {
    if (confirm("¿Estás seguro de que deseas eliminar tu cuenta?")) {
        var usuario_id = ObtenerUsuarioId();

        console.log("Usuario a eliminar: ", usuario_id);

        fetch('http://127.0.0.1:5000/eliminar_usuario', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ usuario_id: usuario_id }),
            credentials: 'include',
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            } else {
                throw new Error("Error al eliminar el usuario. Código de estado: " + response.status);
            }
        })
        .then(data => {
            alert(data.message);
            window.location.href = '/';  
        })
        .catch(error => {
            console.error('Error durante la solicitud:', error);
            alert("Error al eliminar el usuario. Consulta la consola del navegador para más detalles.");

            // Imprimir más detalles sobre el error en la consola
            console.error(error);
        });
    }
}

        

    </script>
</body>
</html>
